# é¡¹ç›®æ‰“åŒ…ç‰ˆæœ¬ç®¡ç†åŠŸèƒ½å®ç°æ€»ç»“

## ğŸ“‹ å®ç°å†…å®¹

### 1. åç«¯æœåŠ¡å±‚

#### âœ… ç‰ˆæœ¬ç®¡ç†æœåŠ¡ (`version-manager.ts`)
**æ–‡ä»¶ä½ç½®**: `packages/cli/src/server/services/version-manager.ts`

**æ ¸å¿ƒåŠŸèƒ½**:
- âœ… è¯»å–å’Œè§£æ `package.json`
- âœ… ç‰ˆæœ¬å·è§£æå’Œæ ¼å¼åŒ–ï¼ˆæ”¯æŒ SemVerï¼‰
- âœ… ç‰ˆæœ¬å·å‡çº§è®¡ç®—ï¼ˆpatch/minor/majorï¼‰
- âœ… è‡ªåŠ¨æ›´æ–° `package.json` æ–‡ä»¶
- âœ… è¯†åˆ«åº“é¡¹ç›®ç±»å‹
- âœ… ç‰ˆæœ¬å‡çº§é¢„è§ˆï¼ˆä¸ä¿®æ”¹æ–‡ä»¶ï¼‰

**å¯¼å‡ºå‡½æ•°**:
```typescript
- readPackageJson(projectPath: string): PackageInfo | null
- writePackageJson(projectPath: string, packageJson: PackageInfo): boolean
- parseVersion(version: string): { major, minor, patch } | null
- bumpVersion(currentVersion: string, bumpType: VersionBumpType): string | null
- updateProjectVersion(projectPath: string, bumpType: VersionBumpType): Result
- getPackageInfo(projectPath: string): PackageInfo
- isLibraryProject(projectPath: string): boolean
- previewVersionBump(currentVersion: string, bumpType: VersionBumpType): Preview
```

---

### 2. API è·¯ç”±å±‚

#### âœ… é¡¹ç›®è·¯ç”±æ‰©å±• (`projects.ts`)
**æ–‡ä»¶ä½ç½®**: `packages/cli/src/server/routes/projects.ts`

**æ–°å¢ API ç«¯ç‚¹**:

| ç«¯ç‚¹ | æ–¹æ³• | æè¿° |
|------|------|------|
| `/api/projects/:id/package-info` | GET | è·å–é¡¹ç›®åŒ…ä¿¡æ¯ |
| `/api/projects/:id/update-version` | POST | æ›´æ–°é¡¹ç›®ç‰ˆæœ¬å· |
| `/api/projects/:id/preview-version` | POST | é¢„è§ˆç‰ˆæœ¬å‡çº§ï¼ˆä¸ä¿®æ”¹æ–‡ä»¶ï¼‰|

**åŠŸèƒ½ç‰¹æ€§**:
- âœ… å‚æ•°éªŒè¯ï¼ˆbumpType åˆæ³•æ€§æ£€æŸ¥ï¼‰
- âœ… é”™è¯¯å¤„ç†å’Œå‹å¥½æç¤º
- âœ… è‡ªåŠ¨è¯†åˆ«é¡¹ç›®ç±»å‹
- âœ… è¿”å›è¯¦ç»†çš„ç‰ˆæœ¬å˜æ›´ä¿¡æ¯

---

### 3. å‰ç«¯ç»„ä»¶å±‚

#### âœ… ç‰ˆæœ¬é€‰æ‹©å™¨ç»„ä»¶ (`VersionSelector.vue`)
**æ–‡ä»¶ä½ç½®**: `packages/cli/src/web/src/components/VersionSelector.vue`

**ç»„ä»¶ç‰¹æ€§**:
- âœ… 4 ç§ç‰ˆæœ¬å‡çº§é€‰é¡¹ï¼ˆä¸å‡çº§/patch/minor/majorï¼‰
- âœ… å®æ—¶é¢„è§ˆç‰ˆæœ¬å˜åŒ–
- âœ… ç²¾ç¾çš„ UI è®¾è®¡ï¼ˆå•é€‰å¡ç‰‡æ ·å¼ï¼‰
- âœ… è¯¦ç»†çš„å‡çº§è¯´æ˜å’Œç¤ºä¾‹
- âœ… ç¦ç”¨çŠ¶æ€æ”¯æŒï¼ˆæ‰“åŒ…è¿›è¡Œæ—¶ï¼‰
- âœ… è¯­ä¹‰åŒ–ç‰ˆæœ¬è§„èŒƒæç¤º

**Props**:
```typescript
{
  modelValue: VersionBumpType  // å½“å‰é€‰æ‹©
  currentVersion?: string      // å½“å‰ç‰ˆæœ¬å·
  disabled?: boolean           // æ˜¯å¦ç¦ç”¨
}
```

**Events**:
```typescript
{
  'update:modelValue': [value: VersionBumpType]
}
```

---

### 4. é¡µé¢é›†æˆå±‚

#### âœ… æ‰“åŒ…é¡µé¢æ›´æ–° (`ProjectAction.vue`)
**æ–‡ä»¶ä½ç½®**: `packages/cli/src/web/src/views/ProjectAction.vue`

**æ–°å¢åŠŸèƒ½**:
1. **åŒ…ä¿¡æ¯æ˜¾ç¤ºå¡ç‰‡**
   - åŒ…åç§°
   - å½“å‰ç‰ˆæœ¬å·ï¼ˆé†’ç›®å¾½ç« æ ·å¼ï¼‰
   - åº“é¡¹ç›®æ ‡è¯†

2. **ç‰ˆæœ¬å‡çº§ç­–ç•¥é€‰æ‹©å™¨**
   - é›†æˆ `VersionSelector` ç»„ä»¶
   - å®æ—¶æ˜¾ç¤ºé¢„è§ˆç‰ˆæœ¬

3. **æ™ºèƒ½æ‰“åŒ…æµç¨‹**
   - æ‰“åŒ…å‰è‡ªåŠ¨æ£€æµ‹ç‰ˆæœ¬å‡çº§ç­–ç•¥
   - é€‰æ‹©å‡çº§æ—¶ï¼Œå…ˆæ›´æ–°ç‰ˆæœ¬å·
   - ç‰ˆæœ¬æ›´æ–°å¤±è´¥è‡ªåŠ¨å–æ¶ˆæ‰“åŒ…
   - å®æ—¶æ—¥å¿—æ˜¾ç¤ºç‰ˆæœ¬å˜åŒ–

4. **ç‰ˆæœ¬ä¿¡æ¯åŠ è½½**
   - è¿›å…¥æ‰“åŒ…é¡µé¢è‡ªåŠ¨åŠ è½½åŒ…ä¿¡æ¯
   - ä»…åœ¨ build é¡µé¢æ˜¾ç¤ºç‰ˆæœ¬ç®¡ç†
   - å®æ—¶è·å–æœ€æ–°ç‰ˆæœ¬ä¿¡æ¯

**æ ¸å¿ƒé€»è¾‘**:
```typescript
// 1. åŠ è½½åŒ…ä¿¡æ¯
loadPackageInfo() â†’ GET /api/projects/:id/package-info

// 2. å¼€å§‹æ‰“åŒ…å‰æ£€æŸ¥
if (build && versionBump !== 'none') {
  // å‡çº§ç‰ˆæœ¬
  updateVersion() â†’ POST /api/projects/:id/update-version
  
  // åˆ·æ–°åŒ…ä¿¡æ¯
  loadPackageInfo()
}

// 3. æ‰§è¡Œæ‰“åŒ…
startBuildProcess()
```

---

## ğŸ¨ UI/UX è®¾è®¡

### ç‰ˆæœ¬å¡ç‰‡è®¾è®¡
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“¦ åŒ…ä¿¡æ¯                            â”‚
â”‚ @ldesign/cache                       â”‚
â”‚                                      â”‚
â”‚ å½“å‰ç‰ˆæœ¬: [v1.0.0] ğŸ·ï¸ åº“é¡¹ç›®        â”‚
â”‚                                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ ç‰ˆæœ¬å‡çº§ç­–ç•¥                     â”‚â”‚
â”‚ â”‚                                  â”‚â”‚
â”‚ â”‚ â—‹ ä¸å‡çº§ â†’ 1.0.0                â”‚â”‚
â”‚ â”‚ â— Patch â†’ 1.0.1                 â”‚â”‚
â”‚ â”‚ â—‹ Minor â†’ 1.1.0                 â”‚â”‚
â”‚ â”‚ â—‹ Major â†’ 2.0.0                 â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ·å¼ç‰¹ç‚¹
- âœ… æ¸å˜è‰²èƒŒæ™¯ï¼ˆå“ç‰Œè‰²ï¼‰
- âœ… å¡ç‰‡é˜´å½±å’Œè¾¹æ¡†
- âœ… äº¤äº’å¼æ‚¬åœæ•ˆæœ
- âœ… æ¸…æ™°çš„ä¿¡æ¯å±‚çº§
- âœ… è¯­ä¹‰åŒ–é¢œè‰²æ ‡è¯†
- âœ… å“åº”å¼å¸ƒå±€

---

## ğŸ”„ å·¥ä½œæµç¨‹

### å®Œæ•´æµç¨‹å›¾
```
1. ç”¨æˆ·è¿›å…¥æ‰“åŒ…é¡µé¢
   â†“
2. è‡ªåŠ¨åŠ è½½é¡¹ç›®ä¿¡æ¯å’ŒåŒ…ä¿¡æ¯
   â†“
3. æ˜¾ç¤ºå½“å‰ç‰ˆæœ¬å’Œç‰ˆæœ¬é€‰æ‹©å™¨
   â†“
4. ç”¨æˆ·é€‰æ‹©ç‰ˆæœ¬å‡çº§ç­–ç•¥
   â†“
5. ç‚¹å‡»"å¼€å§‹æ‰“åŒ…"
   â†“
6. å¦‚æœé€‰æ‹©äº†ç‰ˆæœ¬å‡çº§:
   â”œâ”€ è°ƒç”¨ API æ›´æ–°ç‰ˆæœ¬å·
   â”œâ”€ æ›´æ–° package.json
   â”œâ”€ æ—¥å¿—æ˜¾ç¤ºç‰ˆæœ¬å˜åŒ–
   â””â”€ é‡æ–°åŠ è½½åŒ…ä¿¡æ¯
   â†“
7. æ‰§è¡Œæ‰“åŒ…å‘½ä»¤
   â†“
8. æ˜¾ç¤ºæ‰“åŒ…æ—¥å¿—å’Œç»“æœ
```

---

## ğŸ“ ä»£ç ç¤ºä¾‹

### 1. åç«¯ - ç‰ˆæœ¬å‡çº§
```typescript
import { updateProjectVersion } from './services/version-manager'

const result = updateProjectVersion('/path/to/project', 'patch')

if (result.success) {
  console.log(`ç‰ˆæœ¬å·²æ›´æ–°: ${result.oldVersion} â†’ ${result.newVersion}`)
}
```

### 2. å‰ç«¯ - ä½¿ç”¨ç»„ä»¶
```vue
<template>
  <VersionSelector 
    v-model="selectedVersionBump" 
    :current-version="packageInfo.version"
    :disabled="running"
  />
</template>

<script setup>
import { ref } from 'vue'
import VersionSelector from '@/components/VersionSelector.vue'

const selectedVersionBump = ref('none')
const packageInfo = ref({ version: '1.0.0' })
const running = ref(false)
</script>
```

### 3. API è°ƒç”¨
```typescript
// è·å–åŒ…ä¿¡æ¯
const packageInfo = await api.get('/api/projects/123/package-info')

// æ›´æ–°ç‰ˆæœ¬
const result = await api.post('/api/projects/123/update-version', {
  bumpType: 'patch'
})

// é¢„è§ˆå‡çº§
const preview = await api.post('/api/projects/123/preview-version', {
  bumpType: 'minor'
})
```

---

## âœ¨ åŠŸèƒ½äº®ç‚¹

### 1. è‡ªåŠ¨åŒ–
- âœ… è‡ªåŠ¨è¯†åˆ«é¡¹ç›®ç±»å‹
- âœ… è‡ªåŠ¨è¯»å–å½“å‰ç‰ˆæœ¬
- âœ… è‡ªåŠ¨è®¡ç®—æ–°ç‰ˆæœ¬
- âœ… è‡ªåŠ¨æ›´æ–°æ–‡ä»¶

### 2. æ™ºèƒ½åŒ–
- âœ… æ™ºèƒ½ç‰ˆæœ¬é¢„è§ˆ
- âœ… æ™ºèƒ½é”™è¯¯å¤„ç†
- âœ… æ™ºèƒ½æµç¨‹æ§åˆ¶
- âœ… æ™ºèƒ½UIç¦ç”¨

### 3. ç”¨æˆ·å‹å¥½
- âœ… æ¸…æ™°çš„è§†è§‰åé¦ˆ
- âœ… è¯¦ç»†çš„å‡çº§è¯´æ˜
- âœ… å®æ—¶æ—¥å¿—è¾“å‡º
- âœ… å‹å¥½çš„é”™è¯¯æç¤º

### 4. è§„èŒƒæ€§
- âœ… éµå¾ª SemVer è§„èŒƒ
- âœ… TypeScript ç±»å‹å®‰å…¨
- âœ… å®Œæ•´çš„é”™è¯¯å¤„ç†
- âœ… è¯¦ç»†çš„æ–‡æ¡£è¯´æ˜

---

## ğŸ“š æ–‡æ¡£æ¸…å•

| æ–‡æ¡£ | è·¯å¾„ | æè¿° |
|------|------|------|
| ä½¿ç”¨æŒ‡å— | `docs/version-management-guide.md` | é¢å‘ç”¨æˆ·çš„å®Œæ•´ä½¿ç”¨è¯´æ˜ |
| å®ç°æ€»ç»“ | `docs/version-management-summary.md` | æŠ€æœ¯å®ç°ç»†èŠ‚æ€»ç»“ |
| NPM è®¤è¯æŒ‡å— | `docs/npm-auth-guide.md` | NPM ç™»å½•è®¤è¯å®Œæ•´æŒ‡å— |
| å¿«é€Ÿå‚è€ƒ | `docs/npm-auth-quick-reference.md` | NPM è®¤è¯å¿«é€ŸæŸ¥è¯¢å¡ç‰‡ |

---

## ğŸ§ª æµ‹è¯•å»ºè®®

### å•å…ƒæµ‹è¯•
```typescript
// æµ‹è¯•ç‰ˆæœ¬è§£æ
test('parseVersion should parse valid version', () => {
  expect(parseVersion('1.2.3')).toEqual({ major: 1, minor: 2, patch: 3 })
})

// æµ‹è¯•ç‰ˆæœ¬å‡çº§
test('bumpVersion should increment patch', () => {
  expect(bumpVersion('1.0.0', 'patch')).toBe('1.0.1')
})
```

### é›†æˆæµ‹è¯•
- âœ… æµ‹è¯• API ç«¯ç‚¹
- âœ… æµ‹è¯•æ–‡ä»¶è¯»å†™
- âœ… æµ‹è¯•ç‰ˆæœ¬å‡çº§æµç¨‹
- âœ… æµ‹è¯•é”™è¯¯å¤„ç†

### E2E æµ‹è¯•
- âœ… å®Œæ•´çš„æ‰“åŒ…æµç¨‹
- âœ… ç‰ˆæœ¬é€‰æ‹©äº¤äº’
- âœ… æ—¥å¿—è¾“å‡ºéªŒè¯

---

## ğŸš€ åç»­ä¼˜åŒ–å»ºè®®

### åŠŸèƒ½å¢å¼º
1. **ç‰ˆæœ¬å†å²è®°å½•**
   - è®°å½•æ¯æ¬¡ç‰ˆæœ¬å˜æ›´
   - æ”¯æŒç‰ˆæœ¬å›é€€
   - æ˜¾ç¤ºç‰ˆæœ¬å˜æ›´æ—¶é—´çº¿

2. **CHANGELOG è‡ªåŠ¨ç”Ÿæˆ**
   - æ ¹æ®ç‰ˆæœ¬å˜æ›´è‡ªåŠ¨ç”Ÿæˆ
   - æ”¯æŒè‡ªå®šä¹‰æ¨¡æ¿
   - é›†æˆ Git commit ä¿¡æ¯

3. **å‘å¸ƒç®¡ç†**
   - æ‰“åŒ…åè‡ªåŠ¨å‘å¸ƒåˆ° npm
   - æ”¯æŒé¢„å‘å¸ƒç‰ˆæœ¬ï¼ˆalpha, beta, rcï¼‰
   - å‘å¸ƒå‰æ£€æŸ¥æ¸…å•

4. **å¤šåŒ…ç®¡ç†**
   - Monorepo æ‰¹é‡ç‰ˆæœ¬å‡çº§
   - ä¾èµ–ç‰ˆæœ¬åŒæ­¥æ›´æ–°
   - å·¥ä½œåŒºç‰ˆæœ¬ç»Ÿä¸€ç®¡ç†

### æ€§èƒ½ä¼˜åŒ–
- âœ… ç¼“å­˜åŒ…ä¿¡æ¯
- âœ… å¼‚æ­¥å¹¶å‘å¤„ç†
- âœ… é˜²æŠ–èŠ‚æµä¼˜åŒ–

### ç”¨æˆ·ä½“éªŒ
- âœ… ç‰ˆæœ¬æ¯”è¾ƒå¯è§†åŒ–
- âœ… å‡çº§å½±å“è¯„ä¼°
- âœ… ä¸€é”®å¼å‘å¸ƒæµç¨‹

---

## ğŸ“¦ æ–‡ä»¶æ¸…å•

### åç«¯æ–‡ä»¶
```
packages/cli/src/server/
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ version-manager.ts      (âœ… æ–°å¢)
â”‚   â””â”€â”€ npm-auth.ts             (âœ… æ–°å¢)
â””â”€â”€ routes/
    â””â”€â”€ projects.ts             (âœ… ä¿®æ”¹ - æ–°å¢3ä¸ªAPI)
```

### å‰ç«¯æ–‡ä»¶
```
packages/cli/src/web/src/
â”œâ”€â”€ components/
â”‚   â””â”€â”€ VersionSelector.vue     (âœ… æ–°å¢)
â””â”€â”€ views/
    â””â”€â”€ ProjectAction.vue       (âœ… ä¿®æ”¹ - é›†æˆç‰ˆæœ¬ç®¡ç†)
```

### æ–‡æ¡£æ–‡ä»¶
```
packages/cli/docs/
â”œâ”€â”€ version-management-guide.md    (âœ… æ–°å¢)
â”œâ”€â”€ version-management-summary.md  (âœ… æ–°å¢)
â”œâ”€â”€ npm-auth-guide.md              (âœ… æ–°å¢)
â””â”€â”€ npm-auth-quick-reference.md    (âœ… æ–°å¢)
```

---

## âœ… å®Œæˆæ¸…å•

- [x] åˆ›å»ºç‰ˆæœ¬ç®¡ç†æœåŠ¡æ¨¡å—
- [x] æ·»åŠ  API è·¯ç”±ï¼ˆ3ä¸ªç«¯ç‚¹ï¼‰
- [x] åˆ›å»ºç‰ˆæœ¬é€‰æ‹©å™¨ç»„ä»¶
- [x] é›†æˆåˆ°æ‰“åŒ…é¡µé¢
- [x] æ·»åŠ æ ·å¼è®¾è®¡
- [x] ç¼–å†™ä½¿ç”¨æ–‡æ¡£
- [x] ç¼–å†™å®ç°æ€»ç»“
- [x] NPM è®¤è¯æ–¹æ¡ˆï¼ˆé¢å¤–å®Œæˆï¼‰

---

## ğŸ‰ æ€»ç»“

é¡¹ç›®æ‰“åŒ…ç‰ˆæœ¬ç®¡ç†åŠŸèƒ½å·²å®Œæ•´å®ç°ï¼Œæ¶µç›–ï¼š

1. **åç«¯**: å®Œæ•´çš„ç‰ˆæœ¬ç®¡ç†æœåŠ¡å’Œ API
2. **å‰ç«¯**: ç²¾ç¾çš„ UI ç»„ä»¶å’Œæµç•…çš„äº¤äº’
3. **æ–‡æ¡£**: è¯¦ç»†çš„ä½¿ç”¨æŒ‡å—å’ŒæŠ€æœ¯æ–‡æ¡£
4. **é¢å¤–**: NPM å®˜æ–¹è®¤è¯å®Œæ•´è§£å†³æ–¹æ¡ˆ

æ•´ä¸ªåŠŸèƒ½éµå¾ªæœ€ä½³å®è·µï¼Œä»£ç è´¨é‡é«˜ï¼Œç”¨æˆ·ä½“éªŒå¥½ï¼Œå¯ç›´æ¥æŠ•å…¥ä½¿ç”¨ï¼