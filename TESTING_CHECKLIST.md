# LDesign CLI 测试清单

> 用于验证 CLI 工具所有功能正常工作的完整测试清单

## 📋 测试前准备

- [ ] Node.js >= 18.0.0
- [ ] npm >= 8.0.0
- [ ] 端口 3000 和 5173 未被占用
- [ ] 已安装所有依赖

```bash
# 检查版本
node --version
npm --version

# 检查端口
# Windows
netstat -ano | findstr ":3000"
netstat -ano | findstr ":5173"

# Linux/Mac
lsof -i:3000
lsof -i:5173
```

## 🧪 开发模式测试

### 1. 启动测试

```bash
cd tools/cli
npm run dev
```

**验证点:**
- [ ] 后端服务器成功启动
- [ ] 显示 "✅ 后端服务器已就绪!"
- [ ] 前端服务器成功启动
- [ ] 显示访问地址
- [ ] 没有错误信息

**预期输出:**
```
🚀 启动 LDesign CLI 开发模式...
📦 启动后端服务器 (端口 3000)...
⏳ 等待后端服务器就绪...
✅ 后端服务器已就绪!
🎨 启动前端开发服务器 (端口 5173)...
✨ 开发服务器已启动!
🌐 前端开发服务器: http://localhost:5173
🔌 后端API服务器: http://localhost:3000/api
```

### 2. 前端访问测试

访问 http://localhost:5173

**验证点:**
- [ ] 页面正常加载
- [ ] 没有 404 错误
- [ ] 没有控制台错误
- [ ] 显示 "LDesign CLI" 标题
- [ ] 显示菜单和内容

**浏览器控制台预期输出:**
```
✅ 后端连接成功
🎨 LDesign CLI Web 已启动
```

### 3. API 请求测试

在浏览器中点击 "项目管理" 或其他菜单

**验证点:**
- [ ] API 请求成功
- [ ] 没有 CORS 错误
- [ ] 没有 404 错误
- [ ] 控制台显示请求日志

**浏览器控制台预期日志:**
```
[ApiClient] 请求: GET /api/projects
🔄 代理请求: GET /api/projects
✅ 代理响应: 200 /api/projects
[ApiClient] 响应: /api/projects {...}
```

### 4. 热重载测试

修改 `src/web/src/views/Dashboard.vue`，例如修改标题文字

**验证点:**
- [ ] 页面自动更新
- [ ] 不需要手动刷新
- [ ] 状态保持
- [ ] 没有错误

**终端预期输出:**
```
[Frontend] ✨ hmr update /src/views/Dashboard.vue
```

### 5. 后端热重载测试

修改 `src/server/app.ts`，例如修改健康检查响应

**验证点:**
- [ ] 后端自动重启
- [ ] 前端保持连接
- [ ] 修改生效

**终端预期输出:**
```
[Backend] Restarting 'src/cli/index.ts'...
[Backend] [Server] 服务器创建成功
```

### 6. WebSocket 测试

打开浏览器开发者工具 → Network → WS

**验证点:**
- [ ] WebSocket 连接成功
- [ ] 状态为 "101 Switching Protocols"
- [ ] 可以接收消息

### 7. 停止测试

按 `Ctrl + C`

**验证点:**
- [ ] 显示 "正在关闭开发服务器..."
- [ ] 前后端都正常退出
- [ ] 没有僵尸进程

**预期输出:**
```
正在关闭开发服务器...
👋 再见!
```

## 📦 生产构建测试

### 1. 清理测试

```bash
npm run clean
```

**验证点:**
- [ ] `dist/` 目录被删除
- [ ] 没有错误

### 2. 前端构建测试

```bash
npm run build:web
```

**验证点:**
- [ ] 构建成功
- [ ] 没有 TypeScript 错误
- [ ] 生成 `src/web/dist/` 目录
- [ ] 存在 `index.html`
- [ ] 存在 `assets/` 目录

**预期输出:**
```
vite v5.x.x building for production...
✓ built in xxs
```

### 3. CLI 构建测试

```bash
npm run build:cli
```

**验证点:**
- [ ] 构建成功
- [ ] 生成 `dist/` 目录
- [ ] 存在 `dist/cli/index.js`
- [ ] 存在 `dist/server/app.js`
- [ ] 存在 `dist/core/` 目录

**预期输出:**
```
CLI 2 modules transformed.
✅ CLI 构建完成
```

### 4. 复制测试

```bash
npm run copy:web
```

**验证点:**
- [ ] 复制成功
- [ ] 显示复制进度
- [ ] 显示文件统计
- [ ] `dist/web/index.html` 存在
- [ ] `dist/web/assets/` 存在

**预期输出:**
```
🚀 开始复制 Web 构建产物...
📦 已复制 XX 个文件...
✅ Web 构建产物复制完成
📊 统计: XX 个文件, X 个目录
```

### 5. 完整构建测试

```bash
npm run build
```

**验证点:**
- [ ] 依次执行清理、构建前端、构建CLI、复制
- [ ] 自动运行验证
- [ ] 所有步骤成功
- [ ] 没有错误

**预期输出:**
```
> prebuild
> build:web
> build:cli
> copy:web
> postbuild

🔍 验证构建产物...
✅ 验证通过:
   ✓ CLI 入口文件
   ✓ Express 服务器
   ...
✅ 所有验证通过! (X/X)
🎉 构建产物完整，可以发布或使用
```

### 6. 验证脚本测试

```bash
node scripts/verify-build.js
```

**验证点:**
- [ ] 验证所有必需文件
- [ ] 显示验证结果
- [ ] 全部通过

### 7. 生产启动测试

```bash
npm start
```

**验证点:**
- [ ] 服务器成功启动
- [ ] 监听 3000 端口
- [ ] 显示访问地址
- [ ] 没有错误

**预期输出:**
```
[Server] 正在创建服务器...
[Server] 尝试查找静态资源...
[Server] 找到静态资源: /path/to/dist/web
[Server] 服务器创建成功

  ╭────────────────────────────────────╮
  │   🎨 LDesign UI 已启动!            │
  ╰────────────────────────────────────╯

本地访问: http://localhost:3000
```

### 8. 生产访问测试

访问 http://localhost:3000

**验证点:**
- [ ] 页面正常加载
- [ ] 没有 404 错误
- [ ] 静态资源加载正常
- [ ] CSS 样式正常
- [ ] JavaScript 正常执行
- [ ] 没有控制台错误

### 9. 生产 API 测试

点击菜单，触发 API 请求

**验证点:**
- [ ] API 请求成功
- [ ] 返回正确数据
- [ ] 没有 CORS 错误
- [ ] 响应时间 < 100ms

### 10. 生产 WebSocket 测试

**验证点:**
- [ ] WebSocket 连接成功
- [ ] 可以接收消息
- [ ] 连接稳定

## ⚙️ 配置测试

### 1. 创建配置文件

在 `tools/cli/` 创建 `.ldesignrc.json`:

```json
{
  "defaultPort": 8080,
  "defaultHost": "0.0.0.0",
  "autoOpen": false,
  "debug": true,
  "logLevel": "debug"
}
```

### 2. 配置加载测试

```bash
npm start
```

**验证点:**
- [ ] 使用端口 8080 而不是 3000
- [ ] 不自动打开浏览器
- [ ] 显示调试日志

### 3. 命令行参数覆盖测试

```bash
node dist/cli/index.js ui --port 9000 --no-open
```

**验证点:**
- [ ] 使用端口 9000
- [ ] 不打开浏览器
- [ ] 命令行参数优先于配置文件

## 🔧 CLI 命令测试

### 1. 版本显示

```bash
node dist/cli/index.js --version
```

**验证点:**
- [ ] 显示版本号
- [ ] 格式正确

### 2. 帮助信息

```bash
node dist/cli/index.js --help
node dist/cli/index.js ui --help
```

**验证点:**
- [ ] 显示帮助信息
- [ ] 列出所有命令
- [ ] 显示选项说明

### 3. 调试模式

```bash
node dist/cli/index.js ui --debug
```

**验证点:**
- [ ] 显示详细日志
- [ ] 包含 [Server] 和其他前缀
- [ ] 日志级别为 debug

## 🚨 错误处理测试

### 1. 端口占用测试

先启动一个服务占用 3000 端口，然后启动 CLI

**验证点:**
- [ ] 自动选择其他端口
- [ ] 显示警告信息
- [ ] 服务正常启动

### 2. 前端未构建测试

删除 `dist/web/` 目录，然后启动

**验证点:**
- [ ] 显示占位页面
- [ ] 提示运行构建命令
- [ ] 服务器不崩溃

### 3. 数据库错误测试

创建一个只读的 `ldesign-cli.db` 文件

**验证点:**
- [ ] 显示错误信息
- [ ] 不崩溃
- [ ] 给出解决建议

## 📊 性能测试

### 1. 启动时间

测量从运行命令到服务就绪的时间

**目标:**
- [ ] 开发模式: < 10秒
- [ ] 生产模式: < 3秒

### 2. API 响应时间

测量 API 请求的响应时间

**目标:**
- [ ] 平均响应时间: < 100ms
- [ ] 95% 响应时间: < 200ms

### 3. 页面加载时间

测量页面首次加载时间

**目标:**
- [ ] 开发模式: < 3秒
- [ ] 生产模式: < 2秒

### 4. 内存占用

观察 Node 进程内存占用

**目标:**
- [ ] 启动后: < 200MB
- [ ] 稳定运行: < 300MB

## ✅ 综合验证

### 开发模式完整流程

1. [ ] 安装依赖
2. [ ] 启动开发服务器
3. [ ] 访问前端页面
4. [ ] 测试 API 请求
5. [ ] 测试热重载
6. [ ] 测试 WebSocket
7. [ ] 正常停止

### 生产模式完整流程

1. [ ] 清理旧产物
2. [ ] 完整构建
3. [ ] 验证构建产物
4. [ ] 启动生产服务器
5. [ ] 访问页面
6. [ ] 测试所有功能
7. [ ] 正常停止

### 一致性验证

1. [ ] 开发模式和生产模式页面一致
2. [ ] API 响应一致
3. [ ] 路由行为一致
4. [ ] 功能完全一致

## 🎉 测试完成

如果所有测试通过，说明 CLI 工具已经完全正常工作！

**测试通过标准:**
- ✅ 所有核心功能正常
- ✅ 没有致命错误
- ✅ 性能符合预期
- ✅ 开发和生产环境一致

**下一步:**
- 可以投入实际使用
- 可以开始添加新功能
- 可以进行压力测试

---

**测试日期**: __________  
**测试人**: __________  
**测试结果**: ☐ 通过 ☐ 未通过  
**备注**: __________


