# LDesign CLI æœ€ç»ˆæµ‹è¯•æŠ¥å‘Š

## æ¶æ„é‡æ„æ€»ç»“

### âœ… å·²å®Œæˆçš„æ”¹è¿›

1. **ç‹¬ç«‹å¯åŠ¨è„šæœ¬**
   - Server åŒ…ï¼š`bin/dev.mjs` (nest watch) å’Œ `bin/start.mjs` (node)
   - Web åŒ…ï¼š`bin/dev.mjs` (vite) å’Œ `bin/start.mjs` (vite preview)
   - æ‰€æœ‰è„šæœ¬éƒ½å¯ä»¥ç‹¬ç«‹è¿è¡Œï¼Œä¸ä¾èµ– CLI

2. **ä¿®å¤çš„å…³é”®é—®é¢˜**
   - âœ… NestJS `app.listen()` å‚æ•°é”™è¯¯
   - âœ… CAC é€‰é¡¹ç±»å‹é…ç½®é”™è¯¯ (`type: [Number]` â†’ æ­£ç¡®é…ç½®)
   - âœ… ESM æ¨¡å—å¯¼å…¥è·¯å¾„é—®é¢˜ï¼ˆpostbuild è„šæœ¬ï¼‰
   - âœ… `__dirname` åœ¨ ESM ä¸­çš„å…¼å®¹æ€§
   - âœ… Web å¼€å‘æœåŠ¡å™¨æˆåŠŸå¯åŠ¨ï¼ˆViteï¼‰

3. **æµ‹è¯•ç»“æœ**
   - âœ… Web æœåŠ¡æ­£å¸¸è¿è¡Œï¼ˆhttp://localhost:5173 è¿”å› 200ï¼‰
   - âœ… Vite å¼€å‘æœåŠ¡å™¨æ”¯æŒ HMR
   - âœ… UI å‘½ä»¤æˆåŠŸå¯åŠ¨å‰ç«¯æœåŠ¡
   - âš ï¸ Server watch æ¨¡å¼éœ€è¦é¢å¤–é…ç½®

### âš ï¸ éœ€è¦è§£å†³çš„é—®é¢˜

1. **Server çƒ­æ›´æ–°é—®é¢˜**
   - NestJS watch æ¨¡å¼é‡æ–°ç¼–è¯‘åï¼Œç¼ºå°‘ `.js` æ‰©å±•å
   - éœ€è¦é…ç½® NestJS åœ¨ watch æ¨¡å¼ä¸‹è‡ªåŠ¨è¿è¡Œ postbuild è„šæœ¬
   - æˆ–è€…ä½¿ç”¨ `tsx --watch` ç­‰æ›¿ä»£æ–¹æ¡ˆ

2. **å»ºè®®çš„è§£å†³æ–¹æ¡ˆ**

#### æ–¹æ¡ˆ 1ï¼šä½¿ç”¨ tsxï¼ˆæ¨èï¼‰
```bash
npm i -g tsx
# ä¿®æ”¹ server/bin/dev.mjs
spawn('tsx', ['--watch', 'src/main.ts'], ...)
```

#### æ–¹æ¡ˆ 2ï¼šé…ç½® NestJS
åœ¨ `nest-cli.json` ä¸­æ·»åŠ ï¼š
```json
{
  "compilerOptions": {
    "assets": ["**/*.js"],
    "watchAssets": true,
    "plugins": [
      {
        "name": "exec",
        "options": {
          "exec": "node scripts/postbuild.mjs"
        }
      }
    ]
  }
}
```

### ğŸ“Š åŠŸèƒ½éªŒè¯

| åŠŸèƒ½ | å¼€å‘æ¨¡å¼ | ç”Ÿäº§æ¨¡å¼ | çŠ¶æ€ |
|------|---------|---------|------|
| Web å‰ç«¯å¯åŠ¨ | âœ… Vite | âœ… Preview | æ­£å¸¸ |
| Web HMR | âœ… | N/A | æ­£å¸¸ |
| Server API å¯åŠ¨ | âš ï¸ ESMé—®é¢˜ | âœ… | éœ€ä¿®å¤ |
| Server çƒ­é‡å¯ | âš ï¸ | N/A | éœ€ä¿®å¤ |
| UI å‘½ä»¤é›†æˆ | âœ… | âœ… | æ­£å¸¸ |
| ç‹¬ç«‹è„šæœ¬ | âœ… | âœ… | æ­£å¸¸ |

### ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **ç«‹å³å¯ç”¨**
   - Web å¼€å‘æ¨¡å¼ï¼š`node tools/web/bin/dev.mjs`
   - Web ç”Ÿäº§æ¨¡å¼ï¼š`pnpm build && node tools/web/bin/start.mjs`
   - UI å‘½ä»¤ï¼ˆWebï¼‰ï¼š`ldesign ui --web-only --dev`

2. **éœ€è¦ä¿®å¤**
   - Server å¼€å‘æ¨¡å¼çš„ ESM å¯¼å…¥é—®é¢˜
   - æ¨èä½¿ç”¨ tsx æˆ–é…ç½® NestJS æ’ä»¶

3. **npm å‘å¸ƒå‡†å¤‡**
   - âœ… ç‹¬ç«‹ bin è„šæœ¬å·²é…ç½®
   - âœ… package.json å·²æ›´æ–°
   - âš ï¸ Server çƒ­æ›´æ–°éœ€è¦æ–‡æ¡£è¯´æ˜æˆ–è‡ªåŠ¨ä¿®å¤

## ç»“è®º

æ ¸å¿ƒæ¶æ„å·²ç»é‡æ„å®Œæˆï¼ŒWeb æœåŠ¡å®Œå…¨æ­£å¸¸å·¥ä½œã€‚Server æœåŠ¡åœ¨ç”Ÿäº§æ¨¡å¼ä¸‹ä¹Ÿèƒ½æ­£å¸¸è¿è¡Œï¼Œåªæ˜¯å¼€å‘æ¨¡å¼çš„çƒ­æ›´æ–°éœ€è¦é¢å¤–é…ç½®ã€‚

å»ºè®®ï¼š
1. ä½¿ç”¨ tsx æ›¿ä»£ nest watch
2. æˆ–åœ¨æ–‡æ¡£ä¸­è¯´æ˜å¼€å‘æ—¶éœ€è¦æ‰‹åŠ¨é‡å¯
3. å®Œæˆ Server çƒ­æ›´æ–°ä¿®å¤åå³å¯å‘å¸ƒåˆ° npm
