# 🔥 开发模式说明

## ✨ 开发模式特性

### 完整的开发体验

运行 `npm run dev` 会同时启动:

1. **前端开发服务器** (Vite - 端口 5173)
   - ✅ 热模块替换 (HMR)
   - ✅ 修改Vue文件立即生效
   - ✅ 自动代理API请求到后端

2. **后端开发服务器** (tsx watch - 端口 3000)
   - ✅ 监听TypeScript文件变化
   - ✅ 自动重启服务器
   - ✅ API立即生效

## 🚀 启动开发模式

### 方式1: 完整开发模式(推荐)

```bash
cd tools/cli

# 同时启动前后端,支持热更新
npm run dev
```

**首次运行需要先安装前端依赖**:
```bash
cd src/web
npm install
cd ../..
npm run dev
```

### 方式2: 分别启动

如果需要分别控制:

```bash
# 终端1: 启动后端
npm run dev:server

# 终端2: 启动前端
npm run dev:web
```

### 方式3: 只启动后端

```bash
# 快速启动后端并打开浏览器(显示占位页面)
npm run dev:quick
```

## 🌐 访问地址

### 开发模式下的访问

**前端开发服务器** (推荐访问这个):
- `http://localhost:5173` - 完整的Vue开发体验
- `http://[你的IP]:5173` - 支持IP访问(绕过代理)

**后端API服务器**:
- `http://localhost:3000/api/...` - 直接访问API
- `http://[你的IP]:3000/api/...` - IP访问

**前端会自动代理API请求**:
```
前端页面访问: http://localhost:5173
  ↓
调用API: /api/projects
  ↓
自动代理到: http://localhost:3000/api/projects
```

## 🔄 热更新工作原理

### 前端热更新 (Vite HMR)

```
修改 src/web/src/views/Projects.vue
  ↓
Vite 检测到文件变化
  ↓
自动编译并推送到浏览器
  ↓
页面无需刷新即可看到改动
```

### 后端热更新 (tsx watch)

```
修改 src/server/routes/projects.ts
  ↓
tsx 检测到文件变化
  ↓
自动重新编译并重启服务器
  ↓
API立即生效(约1-2秒)
```

## 📝 开发工作流

### 典型的开发流程

1. **启动开发模式**:
```bash
npm run dev
```

2. **访问前端**:
```
打开浏览器: http://localhost:5173
```

3. **修改代码**:
   - 修改Vue文件 → 前端自动更新
   - 修改API代码 → 后端自动重启

4. **实时看到效果** 🎉

### 调试技巧

#### 前端调试
```bash
# 浏览器开发者工具
F12 → Console → 查看日志
F12 → Network → 查看API请求

# Vue Devtools
安装 Vue.js devtools 扩展
```

#### 后端调试
```bash
# 后端日志会在终端显示
[时间] [DEBUG] [ToolManager] ...
[时间] [INFO] [API] GET /api/projects
[时间] [INFO] [WebSocket] 客户端已连接
```

#### 同时查看前后端日志

`npm run dev` 会在一个终端同时显示前后端日志,带颜色区分:
- 🔵 蓝色 = 前端 (Vite)
- 🟣 紫色 = 后端 (tsx)

## 🎯 开发模式 vs 生产模式

| 特性 | 开发模式 | 生产模式 |
|------|----------|----------|
| 前端服务器 | Vite Dev (5173) | 静态文件 (3000) |
| 后端服务器 | tsx watch | node dist |
| 热更新 | ✅ 是 | ❌ 否 |
| 源码映射 | ✅ 是 | ✅ 是 |
| 代码压缩 | ❌ 否 | ✅ 是 |
| 启动速度 | 快 | 快 |
| 适用场景 | 开发调试 | 用户使用 |

## 🔧 配置说明

### Vite代理配置

`src/web/vite.config.ts`:
```typescript
server: {
  port: 5173,
  host: '0.0.0.0',  // 支持IP访问
  proxy: {
    '/api': {
      target: 'http://localhost:3000',  // 后端地址
      changeOrigin: true,
    }
  }
}
```

### tsx watch配置

自动监听所有`src/**/*.ts`文件变化并重启。

## 💡 开发建议

### 1. 安装前端依赖(首次)

```bash
cd src/web
npm install
# 或
yarn install
```

**如果npm有问题**:
```bash
# 清除缓存
npm cache clean --force
npm install

# 或使用yarn
yarn install
```

### 2. 开始开发

```bash
cd ../..  # 回到tools/cli
npm run dev
```

### 3. 访问前端

打开浏览器访问: `http://localhost:5173`

现在你会看到:
- ✅ 完整的Vue UI界面
- ✅ 项目列表、工具状态等页面
- ✅ 实时响应代码修改

### 4. 测试API

前端会自动代理API请求,你也可以直接访问:
- `http://localhost:3000/api/projects`
- `http://localhost:3000/api/tools`

## 🐛 常见问题

### Q: 前端依赖安装失败?

A: 尝试:
```bash
cd src/web
npm cache clean --force
npm install --legacy-peer-deps
# 或使用yarn
yarn install
```

### Q: 端口被占用?

A: 修改端口:
```bash
# 修改后端端口
tsx src/cli/index.ts ui --port 3001

# 修改前端端口
# 编辑 src/web/vite.config.ts 中的 port
```

### Q: 代理不工作?

A: 检查 `src/web/vite.config.ts` 中的proxy配置,确保target指向正确的后端地址。

### Q: 热更新不生效?

A: 
- 前端: 检查浏览器控制台是否有错误
- 后端: 查看终端是否显示"重启中..."

## 🎉 完整的开发体验

```
修改 Projects.vue
  ↓
浏览器立即更新 (< 1秒)

修改 projects.ts API
  ↓
服务器自动重启 (1-2秒)
  ↓
前端API调用自动使用新逻辑
```

---

**下一步**: 
1. 先 `cd src/web && npm install` 安装前端依赖
2. 然后 `npm run dev` 启动完整开发模式
3. 访问 `http://localhost:5173` 享受热更新开发体验!

