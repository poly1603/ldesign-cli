# LDesign CLI 使用说明

## 快速开始

### 开发模式 (推荐开发时使用)

```bash
cd tools/cli
pnpm dev
```

**访问**: http://localhost:5173

**特点**:
- ✅ 热重载 (修改代码自动刷新)
- ✅ 详细日志 (方便调试)
- ✅ 前后端分离 (Vite + Express)

---

### 生产模式 (测试打包后的版本)

```bash
# 1. 构建
npm run build

# 2. 启动
npm start
```

**访问**: http://localhost:3000

**特点**:
- ✅ 单进程 (前后端合一)
- ✅ 快速启动 (<0.5秒)
- ✅ 生产优化 (压缩、分包)

---

## 命令参数

### UI 命令

```bash
# 基本启动
ldesign ui
# 或 (开发时)
node dist/cli/index.js ui

# 指定端口
ldesign ui --port 8080

# 指定主机
ldesign ui --host 0.0.0.0

# 不自动打开浏览器
ldesign ui --no-open

# 调试模式
ldesign ui --debug

# 组合使用
ldesign ui --port 8080 --no-open --debug
```

### 其他命令

```bash
# 查看版本
ldesign --version

# 查看帮助
ldesign --help
ldesign ui --help
```

---

## 配置文件

### 创建配置

在项目根目录创建 `.ldesignrc.json`:

```json
{
  "defaultPort": 3000,
  "defaultHost": "0.0.0.0",
  "autoOpen": true,
  "debug": false,
  "logLevel": "info",
  "recentProjectsLimit": 10
}
```

### 配置项说明

| 配置项 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| defaultPort | number | 3000 | 默认端口号 |
| defaultHost | string | "0.0.0.0" | 默认主机地址 |
| autoOpen | boolean | true | 是否自动打开浏览器 |
| debug | boolean | false | 是否启用调试模式 |
| logLevel | string | "info" | 日志级别 (debug/info/warn/error/silent) |
| recentProjectsLimit | number | 10 | 最近项目显示数量 |

### 优先级

**命令行参数 > 配置文件 > 默认值**

例如:
```bash
# 配置文件设置 defaultPort: 3000
# 命令行参数 --port 8080
# 实际使用: 8080 (命令行参数优先)
ldesign ui --port 8080
```

---

## 构建脚本

### 清理

```bash
# 清理构建产物
npm run clean

# 清理所有 (包括前端 node_modules)
npm run clean:all
```

### 构建

```bash
# 完整构建 (推荐)
npm run build

# 分步构建
npm run build:web   # 只构建前端
npm run build:cli   # 只构建 CLI
npm run copy:web    # 只复制前端产物
```

### 验证

```bash
# 验证构建产物
node scripts/verify-build.js
```

---

## 常见问题

### Q1: 端口被占用怎么办？

**方法 1**: 自动切换
```bash
# CLI 会自动检测并使用其他端口
ldesign ui
# 输出: 端口 3000 已被占用，使用端口 3001
```

**方法 2**: 手动指定
```bash
ldesign ui --port 8080
```

### Q2: 开发模式 API 请求失败？

**检查**:
1. 确认后端服务器已启动 (端口 3000)
2. 查看浏览器控制台错误
3. 启用调试模式查看详细日志

**解决**:
```bash
# 启用调试模式
pnpm dev:server -- --debug
```

### Q3: 生产模式页面空白？

**检查**:
1. 确认已构建: `npm run build`
2. 验证产物: `node scripts/verify-build.js`
3. 查看构建日志

**解决**:
```bash
# 重新完整构建
npm run clean
npm run build
npm start
```

### Q4: 修改代码不生效？

**开发模式**: 
- 前端会自动热重载
- 后端会自动重启

**生产模式**:
- 需要重新构建: `npm run build`
- 重启服务器: `npm start`

---

## 开发工作流

### 日常开发

```bash
# 1. 启动开发服务器
pnpm dev

# 2. 修改代码
# 前端代码在 src/web/src/
# 后端代码在 src/cli/, src/server/, src/core/

# 3. 自动重载
# 保存后自动生效

# 4. 测试功能
# 在浏览器中测试
```

### 发布前

```bash
# 1. 清理
npm run clean

# 2. 构建
npm run build
# 自动验证产物完整性

# 3. 测试
npm start
# 在浏览器中完整测试

# 4. 确认无误后发布
```

---

## 目录结构

```
tools/cli/
├── bin/              # CLI 可执行文件
├── src/              # 源代码
│   ├── cli/         # CLI 命令
│   ├── server/      # Express 服务器
│   ├── core/        # 核心业务
│   ├── web/         # Vue3 前端
│   └── shared/      # 共享代码
├── scripts/          # 构建脚本
├── dist/             # 构建产物
└── docs/             # 文档
```

---

## 相关文档

- [README.md](./README.md) - 项目介绍
- [QUICK_START_GUIDE.md](./QUICK_START_GUIDE.md) - 快速开始
- [docs/DEVELOPMENT.md](./docs/DEVELOPMENT.md) - 开发指南
- [docs/TROUBLESHOOTING_NEW.md](./docs/TROUBLESHOOTING_NEW.md) - 故障排除
- [🏆_最终验证报告.md](./🏆_最终验证报告.md) - 验证报告

---

**当前状态**: ✅ 全功能可用  
**版本**: 1.0.0  
**质量**: ⭐⭐⭐⭐⭐

